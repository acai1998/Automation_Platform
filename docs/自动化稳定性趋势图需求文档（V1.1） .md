# 自动化稳定性趋势图需求文档（V1.1）

> 文档目的：
> 本文档用于完整记录【自动化测试平台】中“稳定性趋势图”功能的**一期可落地需求**，作为后续开发、迭代、回溯与面试展示的统一依据。
>
> 本期遵循原则：
>
> * 不一次性做完所有能力
> * 每一版都形成可用闭环
> * 明确数据口径、交互边界、后续扩展方向

---

## 1. 背景说明

当前平台中已存在“30 天稳定性趋势”展示模块，但形态为**静态 SVG 图形**，仅用于宏观展示，存在以下问题：

* 无法查看每天的具体数据（成功率 / 执行数）
* 时间轴不是真实日期，仅为“第 N 周”
* 不支持时间周期切换（7 / 30 / 90 天）
* 图表不可交互，分析价值有限
* 无法作为后续质量分析的基础能力

因此，需要对该模块进行**数据化、组件化、可迭代升级**。

---

## 2. 需求目标

### 2.1 总体目标

> 将稳定性趋势图从“展示型图形”升级为“**可分析的数据型图表**”，支持按天粒度分析自动化执行稳定性。

### 2.2 本期（V1.1）目标

* 支持按 **天维度** 展示稳定性数据
* 支持 **近 7 / 30 / 90 天** 时间周期切换
* 图表随周期切换自动更新 X 轴日期
* 支持折线图 / 柱状图切换
* 统一采用 **T-1 数据口径**，保证数据准确性
* 保证在数据密集场景下的**可读性**（日期不拥挤）

---

## 3. 名词与口径说明（非常重要）

### 3.1 稳定性定义

* 稳定性 = 自动化用例成功率

```
稳定性（%） = 成功用例数 / 总执行用例数 * 100
```

### 3.2 数据时间口径（T-1 规则）

* 当天（T）的执行数据**不参与展示**
* 平台仅展示 **已完整产出的统计数据**
* 最新可展示日期 = 当前日期 - 1 天（T-1）

#### 示例

| 当前日期       | 图表最新日期     |
| ---------- | ---------- |
| 2025-12-27 | 2025-12-26 |

> 说明：
> 该规则用于避免展示统计未完成的数据，是数据平台的通用实践。

---

## 4. 功能范围说明

### 4.1 本期支持功能（V1.1）

#### 4.1.1 时间周期切换

页面右上角提供时间周期切换选项：

* 近 7 天
* 近 30 天（默认）
* 近 90 天

切换周期后：

* 自动重新请求后端数据
* 图表数据与 X 轴日期同步更新
* 下方汇总指标同步刷新

---

#### 4.1.2 图表类型切换

支持两种图表形态：

* 折线图（默认）
* 柱状图

说明：

* 图表类型切换不影响数据范围
* 切换后保持当前时间周期

---

#### 4.1.3 X 轴日期展示规则（重点）

为避免日期过多导致拥挤，需根据时间周期自动调整 X 轴展示策略：

| 时间周期   | 日期展示方式                |
| ------ | --------------------- |
| 近 7 天  | 横向完整展示                |
| 近 30 天 | 日期倾斜展示（约 30°）         |
| 近 90 天 | 日期倾斜展示（约 45°），并自动稀疏刻度 |

补充说明：

* 数据点仍按“每天”完整展示
* 仅对 X 轴**标签显示方式**做优化
* Hover Tooltip 中需展示完整日期

---

#### 4.1.4 Hover 交互

当鼠标悬停在某一天的数据点上时，需展示 Tooltip，包含：

* 日期（YYYY-MM-DD）
* 当天执行用例总数
* 成功用例数
* 失败用例数
* 成功率（%）

---

### 4.2 本期明确不做（边界）

以下功能**不在 V1.1 范围内**，作为后续版本规划：

* 点击某一天，下钻查看失败用例详情
* 自定义起止时间选择
* 按周 / 按月聚合展示
* 多任务、多系统对比展示
* 同一图表展示多个指标

> 说明：
> 明确“不做”是为了保证本期需求可控、可交付。

---

## 5. 页面结构说明（文字示意）

```
┌──────────────────────────────────┐
│ 自动化稳定性趋势                │
│                                  │
│ [ 折线图 | 柱状图 ]   [ 7天 | 30天 | 90天 ] │
│                                  │
│  ┌────────────────────────────┐  │
│  │   稳 定 性 趋 势 图 表       │  │
│  │   · X轴：日期（按规则展示） │  │
│  │   · Y轴：成功率（%）        │  │
│  │   · Hover 查看每日数据      │  │
│  └────────────────────────────┘  │
│                                  │
│ 本周期汇总：                     │
│ - 平均成功率                     │
│ - 总执行次数                     │
│ - 总失败次数                     │
└──────────────────────────────────┘
```

---

## 6. 后端数据模型（本期使用）

### 6.1 核心表：每日稳定性统计表

```sql
daily_stability_stat
--------------------
id
stat_date        -- 数据日期（如 2025-12-26）
task_id          -- 自动化任务 ID
total_count      -- 当天执行用例总数
pass_count       -- 成功用例数
fail_count       -- 失败用例数
pass_rate        -- 成功率（0-100）
created_at
updated_at
```

说明：

* 每天每个任务一条或多条（可累加）
* 数据在 T+1 生成，对外只展示到 T-1

---

### 6.2 后端接口约定

```http
GET /api/stability/daily
  ?task_id=xxx
  &range=30
```

接口行为约定：

* 后端根据 `range` 自动计算时间区间
* 查询范围：`[T-1-range+1, T-1]`
* 前端无需感知 T-1 逻辑

返回示例：

```json
[
  {
    "date": "2025-12-26",
    "total": 120,
    "pass": 108,
    "fail": 12,
    "pass_rate": 90
  }
]
```

---

## 7. 需求迭代记录建议

建议在平台中维护【需求迭代时间线】页面，用于记录每一次需求演进。

### 示例记录

**2025-12-26｜稳定性趋势图 V1.1**

* 新增：7 / 30 / 90 天时间周期切换
* 新增：X 轴日期自适应展示规则
* 新增：T-1 数据展示口径
* 后端：新增 daily_stability_stat 聚合表
* 状态：已完成

---

## 8. 后续版本规划（V2 方向）

* 点击某一天，下钻查看失败用例 Top N
* 失败原因分类统计
* 不稳定用例识别（波动分析）
* 多任务稳定性对比

> 本文档仅覆盖 V1.1，不作为后续版本的强制实现要求。

---

## 9. 总结

本需求通过：

* 明确数据口径（T-1）
* 控制功能边界
* 采用按天粒度 + 时间周期切换
* 提前考虑可读性与扩展性

为自动化测试平台后续的质量分析能力奠定基础。
