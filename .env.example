# ═══════════════════════════════════════════════════════════════════════════
# 自动化测试平台 - 环境变量配置示例
# ═══════════════════════════════════════════════════════════════════════════
# 说明：复制此文件为 .env，然后填入实际的值
# 重要：.env 文件包含敏感信息，不应提交到版本控制！
# ═══════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# 1. 应用基本配置
# ─────────────────────────────────────────────────────────────────────────────

# 应用运行环境：development | staging | production
NODE_ENV=development

# 应用监听端口（后端）
PORT=3000

# 数据库配置（如需）
DATABASE_URL=

# ─────────────────────────────────────────────────────────────────────────────
# 2. Jenkins 配置（必需）
# ─────────────────────────────────────────────────────────────────────────────

# Jenkins 服务器地址
# 示例：http://jenkins.wiac.xyz:8080/
#      http://localhost:8080/
#      https://jenkins.company.com/
JENKINS_URL=http://jenkins.wiac.xyz:8080/

# Jenkins 用户名（用于 Jenkins API 认证）
JENKINS_USER=root

# Jenkins API Token（从 Jenkins 个人设置页面生成）
# 步骤：Jenkins → 用户 → 配置 → API Token → 生成
JENKINS_TOKEN=116fb13c3cc6cd3e33e688bacc26e18b60

# Jenkins Job 配置（可选，如果使用默认名称可不改）
JENKINS_JOB_API=api-automation
JENKINS_JOB_UI=ui-automation
JENKINS_JOB_PERF=performance-automation

# Jenkins 回调 URL
# 此 URL 用于 Jenkins 在执行完成后回调本平台
# 示例：http://platform.example.com/api/jenkins/callback
#      http://localhost:3000/api/jenkins/callback
API_CALLBACK_URL=http://localhost:3000/api/jenkins/callback

# ─────────────────────────────────────────────────────────────────────────────
# 3. Jenkins 认证配置（必需）
# ─────────────────────────────────────────────────────────────────────────────
# 注意：应用需要以下三个环境变量来完成启动。如果缺失任何一个，应用将报错。

# API Key（用于回调认证方式1：API Key）
# 建议生成一个强密钥，例如：
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JENKINS_API_KEY=your-secret-api-key-here-min-8-chars

# JWT Secret（用于回调认证方式2：JWT Token）
# 建议使用强密钥
JENKINS_JWT_SECRET=your-secret-jwt-key-here-min-8-chars

# Signature Secret（用于回调认证方式3：HMAC-SHA256 签名）
# 建议使用强密钥
JENKINS_SIGNATURE_SECRET=your-secret-signature-key-here-min-8-chars

# ─────────────────────────────────────────────────────────────────────────────
# 4. IP 白名单配置（可选）
# ─────────────────────────────────────────────────────────────────────────────
# 说明：
#   - 留空：允许任何 IP 访问
#   - 精确 IP：192.168.1.100,10.0.0.5
#   - CIDR 网段：192.168.1.0/24,10.0.0.0/8
#   - localhost：localhost（自动识别 127.0.0.1, ::1）
#   - 混合：192.168.1.0/24,10.0.0.5,localhost
#
# 推荐配置：只允许 Jenkins 服务器 IP 或内网网段
# 示例：JENKINS_ALLOWED_IPS=192.168.1.100,10.0.0.0/24,localhost

JENKINS_ALLOWED_IPS=

# ─────────────────────────────────────────────────────────────────────────────
# 5. 调试配置（可选）
# ─────────────────────────────────────────────────────────────────────────────

# 启用 IP 地址识别调试日志
# 当设置为 'true' 时，会在开发环境中记录 IP 识别过程的详细信息
JENKINS_DEBUG_IP=false

# 启用详细日志
DEBUG=false

# ============== 邮件通知配置（可选）==============

# SMTP 服务器地址
SMTP_HOST=

# SMTP 端口
SMTP_PORT=587

# SMTP 用户名
SMTP_USER=

# SMTP 密码
SMTP_PASSWORD=

# 发件人邮箱
EMAIL_FROM=

# ═══════════════════════════════════════════════════════════════════════════
# 快速开始步骤
# ═══════════════════════════════════════════════════════════════════════════
#
# 1. 复制此文件：
#    cp .env.example .env
#
# 2. 编辑 .env 文件，填入实际的配置值：
#    - 必填：JENKINS_API_KEY, JENKINS_JWT_SECRET, JENKINS_SIGNATURE_SECRET
#    - 可选：JENKINS_ALLOWED_IPS, 其他 Jenkins 配置
#
# 3. 验证配置（启动前）：
#    npm run check-env
#
# 4. 启动应用：
#    npm run start
#
# 5. 测试回调连接：
#    curl -X POST http://localhost:3000/api/jenkins/callback/test \
#      -H "X-Api-Key: your-secret-api-key-here" \
#      -H "Content-Type: application/json" \
#      -d '{"testMessage": "hello"}'
#
# 6. 如果收到成功响应，说明配置正确！
#
# ═══════════════════════════════════════════════════════════════════════════
# 需要帮助？
# ═══════════════════════════════════════════════════════════════════════════
#
# 详细配置指南：docs/JENKINS_AUTH_QUICK_START.md
# 常见问题：docs/JENKINS_AUTH_QUICK_START.md#常见问题
# 诊断工具：POST /api/jenkins/callback/diagnose
# 健康检查：GET /api/jenkins/health
#
# ═══════════════════════════════════════════════════════════════════════════
